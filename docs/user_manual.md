# IFLV (假驴子) 用户手册

## 目录

1. [产品介绍](#产品介绍)
2. [系统要求](#系统要求)
3. [安装指南](#安装指南)
   - [一键安装](#一键安装)
   - [手动安装](#手动安装)
   - [不同架构安装说明](#不同架构安装说明)
4. [界面介绍](#界面介绍)
   - [全局设置](#全局设置)
   - [频道管理](#频道管理)
   - [EPG设置](#EPG设置)
   - [客户端下载](#客户端下载)
   - [日志查看](#日志查看)
5. [使用教程](#使用教程)
   - [基本设置](#基本设置)
   - [频道配置](#频道配置)
   - [EPG设置](#EPG设置与更新)
   - [客户端连接](#客户端连接)
6. [常见问题解答](#常见问题解答)
7. [故障排查](#故障排查)
8. [版本历史](#版本历史)
9. [支持与反馈](#支持与反馈)

## 产品介绍

IFLV (假驴子) 是一款为OpenWRT路由器设计的智能IPTV转发器插件，可以让您家中的多个设备不需要机顶盒即可观看IPTV直播。通过将IPTV信号从组播转换为单播，IFLV能够帮助用户在手机、电脑、平板等多种终端上流畅观看IPTV节目。

### 主要功能

- **智能组播转单播**：将运营商提供的组播IPTV信号转换为适合家庭网络的单播信号
- **多协议支持**：支持RTSP、RTMP、HLS等多种流媒体协议
- **电子节目单(EPG)**：提供直观的节目预告信息，支持自动更新和频道匹配
- **多平台客户端**：提供Android、Windows、iOS、Mac等多平台客户端应用
- **资源占用低**：优化代码设计，对路由器资源占用极小
- **安全稳定**：支持HTTPS传输、定期备份、故障自动恢复等机制

## 系统要求

- **支持的路由器系统**：OpenWRT 19.07及以上版本
- **最低硬件要求**：
  - CPU: 单核580MHz以上
  - 内存: 128MB及以上
  - 存储: 16MB可用空间
- **推荐硬件配置**：
  - CPU: 双核800MHz以上
  - 内存: 256MB及以上
  - 存储: 32MB可用空间

## 安装指南

### 一键安装

一键安装是最简单的安装方法，只需在路由器的SSH终端中执行以下命令：

```bash
wget -O /tmp/install.sh https://iflv.io/install.sh && chmod +x /tmp/install.sh && /tmp/install.sh
```

安装过程会自动检测您的路由器架构，并下载对应的安装包进行安装。整个过程通常不超过3分钟。

### 手动安装

如果您无法使用一键安装，或者希望更精细地控制安装过程，可以按照以下步骤进行手动安装：

1. 访问 [https://iflv.io/download](https://iflv.io/download) 下载适合您路由器架构的安装包
2. 将下载的ipk文件上传到路由器的/tmp目录
3. 登录路由器的SSH终端
4. 执行安装命令：

```bash
opkg update
opkg install /tmp/luci-app-iflv_1.1.0_all.ipk
```

5. 安装完成后，在路由器管理界面的"服务"选项卡中即可找到"IFLV"应用

### 不同架构安装说明

IFLV支持多种路由器架构，包括但不限于：

| 架构 | 对应安装包 | 适用设备举例 |
|------|------------|------------|
| mipsel_24kc | luci-app-iflv_1.1.0_mipsel_24kc.ipk | 小米路由器、极路由、斐讯K2P |
| arm_cortex-a7 | luci-app-iflv_1.1.0_arm_cortex-a7.ipk | 红米AC2100、新华三WR1200JS |
| arm_cortex-a9 | luci-app-iflv_1.1.0_arm_cortex-a9.ipk | 友华WR1200JS、Linksys EA6500 |
| x86_64 | luci-app-iflv_1.1.0_x86_64.ipk | X86软路由 |

如果您不确定自己的路由器架构，可以在SSH中执行以下命令查看：

```bash
opkg print-architecture
```

## 界面介绍

安装IFLV后，您可以通过路由器管理界面访问IFLV的配置面板。以下是各个界面的详细介绍：

### 全局设置

![全局设置界面](../assets/global_settings.png)

全局设置页面包含以下选项：

- **启用IFLV服务**：总开关，控制IFLV服务的启动和停止
- **IPTV接口**：选择连接IPTV信号的网络接口，通常是WAN口
- **服务端口**：设置IFLV服务监听的端口，默认为8888
- **日志级别**：控制日志详细程度，可选择错误、警告、信息、调试
- **启用HTTPS**：是否启用HTTPS安全传输
- **HTTPS端口**：HTTPS服务监听的端口，默认为8443
- **自动生成证书**：是否自动生成自签名SSL证书

### 频道管理

![频道管理界面](../assets/channel_management.png)

频道管理页面允许您：

- 查看当前已配置的频道列表
- 手动添加新频道
- 导入/导出频道列表
- 扫描可用频道
- 设置频道分组和排序

### EPG设置

![EPG设置界面](../assets/epg_settings.png)

EPG设置页面包含以下选项：

- **启用EPG功能**：控制是否启用电子节目单功能
- **更新间隔**：设置EPG数据自动更新的时间间隔
- **EPG数据源**：配置EPG数据的获取来源
- **自动频道匹配**：是否启用智能频道匹配功能
- **备份设置**：配置EPG数据的备份策略
- **首选语言**：设置EPG显示的首选语言

### 客户端下载

![客户端下载界面](../assets/client_download.png)

客户端下载页面提供：

- 各平台客户端的下载链接
- 客户端版本信息
- 安装教程链接
- 二维码快速下载

### 日志查看

![日志查看界面](../assets/log_view.png)

日志查看页面允许您：

- 查看IFLV运行日志
- 设置日志过滤条件
- 导出日志文件
- 清空日志记录

## 使用教程

### 基本设置

1. 登录路由器管理界面，找到"服务"选项卡中的"IFLV"
2. 进入"全局设置"页面
3. 确保"启用IFLV服务"已勾选
4. 选择正确的"IPTV接口"（通常是连接到IPTV信号的网络接口）
5. 点击"保存并应用"按钮
6. 等待服务启动完成（通常需要10-30秒）

### 频道配置

#### 自动扫描频道

1. 进入"频道管理"页面
2. 点击"扫描频道"按钮
3. 选择扫描模式（快速/完整）
4. 点击"开始扫描"
5. 等待扫描完成（根据网络情况可能需要3-10分钟）
6. 从扫描结果中选择您需要的频道，点击"添加所选频道"

#### 手动添加频道

1. 进入"频道管理"页面
2. 点击"添加频道"按钮
3. 填写频道信息：
   - 频道名称
   - 频道URL（组播地址）
   - 频道分组（可选）
   - EPG ID（可选，用于关联节目单）
4. 点击"保存"按钮

### EPG设置与更新

1. 进入"EPG设置"页面
2. 确保"启用EPG功能"已勾选
3. 设置"更新间隔"（建议24小时）
4. 配置"EPG数据源"（可使用默认源或添加自定义源）
5. 启用"自动频道匹配"以自动关联频道和节目单
6. 点击"保存并应用"
7. 如需立即更新EPG数据，点击"立即更新EPG"按钮

### 客户端连接

#### Android客户端

1. 在路由器管理界面的"客户端下载"页面获取Android客户端
2. 安装APK文件
3. 打开IFLV客户端
4. 客户端会自动搜索同一网络内的IFLV服务
5. 点击发现的服务器进行连接
6. 连接成功后，可以浏览和观看频道

#### Windows客户端

1. 下载并安装Windows客户端
2. 运行IFLV客户端
3. 在首次运行时，输入IFLV服务器地址（路由器IP:端口）
4. 客户端会保存设置并连接到服务器
5. 连接成功后即可观看电视节目

#### iOS/Mac客户端

1. 下载并安装iOS/Mac客户端
2. 打开客户端
3. 点击"添加服务器"按钮
4. 输入IFLV服务器信息或使用自动扫描
5. 连接成功后即可使用

## 常见问题解答

### 1. 无法启动IFLV服务

**问题描述**：点击启用IFLV服务后，服务无法正常启动。

**解决方案**：
- 检查路由器是否有足够的内存和存储空间
- 确认选择了正确的IPTV接口
- 查看系统日志，寻找具体错误信息
- 尝试重启路由器后再启动服务

### 2. 客户端无法连接到IFLV服务

**问题描述**：客户端应用无法找到或连接到路由器上的IFLV服务。

**解决方案**：
- 确认IFLV服务已在路由器上正常启动
- 检查客户端设备和路由器是否在同一网络中
- 确认路由器防火墙没有阻止IFLV服务端口
- 手动输入路由器IP地址和IFLV服务端口尝试连接

### 3. 播放IPTV时出现卡顿或无画面

**问题描述**：连接成功但播放电视频道时经常卡顿或完全没有画面。

**解决方案**：
- 检查网络带宽是否足够（IPTV通常需要5-10Mbps的稳定带宽）
- 确认路由器性能是否满足要求
- 尝试降低画质设置
- 检查IPTV信号源是否稳定
- 关闭网络中其他占用带宽的应用

### 4. EPG数据无法更新

**问题描述**：电子节目单(EPG)不显示或无法更新。

**解决方案**：
- 确认"EPG功能"已启用
- 检查EPG数据源是否可访问
- 手动触发EPG更新
- 查看日志文件了解详细错误信息
- 尝试更换其他EPG数据源

### 5. 部分频道无法播放

**问题描述**：某些特定频道无法播放，但其他频道正常。

**解决方案**：
- 检查该频道的URL地址是否正确
- 确认您的网络运营商未限制该频道访问
- 尝试更新频道列表
- 检查该频道是否需要额外授权

## 故障排查

### 日志分析

IFLV的主要日志文件位于 `/var/log/iflv.log`，您可以通过以下命令查看：

```bash
cat /var/log/iflv.log
```

或者在路由器管理界面的"日志查看"页面中直接查看。

常见的错误日志及解决方法：

| 错误信息 | 可能的原因 | 解决方法 |
|----------|------------|---------|
| Failed to bind to port | 端口被占用 | 更换IFLV服务端口 |
| Cannot open IPTV interface | 接口配置错误 | 检查并修正IPTV接口设置 |
| EPG download failed | 网络问题或源地址错误 | 检查网络连接或更换EPG数据源 |
| Out of memory | 内存不足 | 减少同时播放的频道数或升级路由器 |

### 命令行工具

IFLV提供了多个命令行工具，可帮助您进行故障排查：

- **iflv status**：检查IFLV服务状态
  ```bash
  /usr/bin/iflv status
  ```

- **iflv_update_epg force**：强制更新EPG数据
  ```bash
  /usr/bin/iflv_update_epg force
  ```

- **iflv_announcement show**：显示最新公告
  ```bash
  /usr/bin/iflv_announcement show
  ```

- **iflv restart**：重启IFLV服务
  ```bash
  /usr/bin/iflv restart
  ```

### 常见性能问题

如果您遇到性能问题，可以尝试以下优化措施：

1. **降低同时播放数量**：减少同时播放的频道数量
2. **优化网络环境**：使用有线连接而非WiFi
3. **调整缓冲设置**：增加客户端的缓冲时间
4. **关闭不必要的功能**：如不需要EPG，可以关闭该功能
5. **定期重启路由器**：设置自动定期重启计划

## 版本历史

请参考[CHANGELOG.md](../CHANGELOG.md)文件获取完整的版本历史信息。

## 支持与反馈

- **官方网站**：[https://iflv.io](https://iflv.io)
- **GitHub仓库**：[https://github.com/username/luci-app-iflv](https://github.com/username/luci-app-iflv)
- **问题报告**：如发现问题，请在GitHub仓库提交Issue
- **功能建议**：欢迎通过GitHub仓库提交Pull Request或Issue
- **社区支持**：可加入我们的用户交流群获取社区支持 