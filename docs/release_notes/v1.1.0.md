# IFLV 1.1.0 版本发布说明

发布日期: 2024-03-15

## 概述

IFLV 1.1.0版本带来多项重要更新，重点优化了EPG数据处理、版本管理系统和用户文档，同时进一步优化了项目结构。这个版本是自1.0.1以来的首个功能性更新版本，增加了多项用户需求功能，并解决了一些已知问题。

## 主要功能更新

### EPG数据处理优化

- **智能数据解析算法**: 全新开发的EPG解析引擎，提高解析速度40%以上
- **数据精简优化**: 智能筛选未来7天节目信息，显著减少文件大小
- **语言优先级设置**: 新增首选语言配置，优先显示用户选择的语言节目信息
- **增强的频道匹配**: 改进字符串相似度算法，提高频道匹配准确率
- **处理性能统计**: 新增EPG处理统计功能，提供直观的优化效果报告

### 版本公告系统

- **公告管理**: 全新公告获取和显示系统，实时获取最新版本信息
- **历史公告**: 支持查看和管理历史版本公告
- **系统通知集成**: 与路由器通知系统集成，推送版本更新提醒
- **本地公告发布**: 支持本地生成和测试公告(开发者功能)

### 全面文档更新

- **用户手册**: 详细的使用教程，覆盖从安装到高级功能的全流程
- **安装指南**: 针对不同架构路由器的专门安装说明
- **常见问题解答**: 全面的FAQ文档，提供详细排障步骤
- **开发文档**: 补充项目结构和API说明，方便二次开发

### 项目结构优化

- **标准化目录结构**: 重组项目文件，建立清晰的目录结构
- **清理工具**: 新增项目清理脚本，删除无用文件，优化存储
- **版本发布记录**: 规范的版本和发布记录保存机制

## 技术细节

### EPG更新脚本改进

1. **数据解析算法**:
   - 使用awk替代grep处理大文件，显著提高性能
   - 实现增量处理机制，只处理变更部分
   - 添加XML数据验证，提高解析稳定性

2. **智能数据优化**:
   - 基于时间戳筛选未来节目，自动过滤过期内容
   - 优先保留首选语言内容，减少多语言冗余
   - 节目描述智能截断，保留核心信息

3. **统计功能**:
   - 提供处理前后对比数据，包括文件大小、节目数量变化
   - 生成JSON格式统计信息，供LuCI界面展示
   - 记录处理耗时和资源占用

### 公告系统实现

1. **数据获取与存储**:
   - 支持多种数据源，默认从官方服务器获取
   - 本地缓存机制，减少网络请求
   - 历史公告备份与管理

2. **版本比较**:
   - 语义化版本号比较，准确识别新版本
   - 自动通知机制，用户无需手动检查

3. **命令行工具**:
   - 提供完整的命令行接口，支持查看、管理公告
   - 支持本地测试和开发用途

### 文档系统

1. **内容组织**:
   - 按主题和难度级别组织文档内容
   - 添加丰富的实例和截图说明
   - 提供命令行示例和常见问题解决方案

2. **格式规范**:
   - 使用标准Markdown格式，支持各种Markdown查看器
   - 统一的文档样式和组织结构
   - 交叉引用和文档间链接

## 已修复问题

- 修复特定条件下EPG匹配失败的问题
- 解决非UTF-8编码EPG源解析错误
- 修复部分路由器架构上频道扫描缓慢的问题
- 解决多客户端同时连接可能导致的内存泄漏
- 修复WebUI中某些设置项无法保存的问题

## 已知问题

- 在部分低端路由器(内存<64MB)上，EPG更新可能导致内存不足
- iOS客户端在特定网络环境下可能出现连接不稳定情况
- WebUI在某些旧版浏览器中可能显示异常

## 安装说明

### 新安装

按照[安装指南](../installation.md)中的步骤进行安装。

### 从旧版本升级

1. **备份配置**:
   ```bash
   cp /etc/config/iflv /etc/config/iflv.bak
   ```

2. **停止服务**:
   ```bash
   /etc/init.d/iflv stop
   ```

3. **安装新版本**:
   ```bash
   opkg install --force-overwrite /tmp/luci-app-iflv_1.1.0_*.ipk
   ```

4. **重启服务**:
   ```bash
   /etc/init.d/iflv start
   ```

5. **验证升级**:
   ```bash
   /usr/bin/iflv version
   ```

## 致谢与参考

IFLV 1.1.0版本在开发过程中参考和借鉴了多个开源项目和社区资源的代码和设计思路。我们特别感谢以下项目及其作者的贡献：

### 参考项目

- **[iptv-api](https://github.com/Guovin/iptv-api/)** 
  - 参考内容: EPG解析引擎设计、多源数据合并逻辑
  - 具体应用: 优化的`optimize_epg_data()`函数和EPG数据合并算法

- **[luci-app-store](https://github.com/jiecai58/luci-app-store)**
  - 参考内容: LuCI界面框架、版本更新机制
  - 具体应用: 版本更新检测系统和`iflv_announcement`脚本实现

- **[iptv-tool](https://github.com/super321/iptv-tool)**
  - 参考内容: 频道扫描功能、协议识别优化
  - 具体应用: 自动识别不同协议的IPTV流并进行适当处理

- **[IPTV组播转发方案](https://www.right.com.cn/forum/thread-8319904-1-1.html)**
  - 参考内容: 组播转单播核心实现思路
  - 具体应用: IPTV信号转发核心逻辑和网络接口处理方法

- **[IPTV地址提取工具](https://github.com/gyssi007/-IPTV-/blob/main/IPTV%E5%9C%B0%E5%9D%80%E6%8F%90%E5%8F%96%E5%B7%A5%E5%85%B7.html)**
  - 参考内容: IPTV地址识别与处理方法
  - 具体应用: 频道URL解析和规范化处理算法

- **[xinjiawei/iptv](https://github.com/xinjiawei/iptv)**
  - 参考内容: 客户端实现参考、流媒体协议处理
  - 具体应用: 多协议支持和流转换处理技术

- **[OpenWRT IPTV助手](https://www.right.com.cn/FORUM/thread-8413979-1-1.html)**
  - 参考内容: IGMP代理配置方法、网络接口处理
  - 具体应用: IGMP代理自动配置功能和网络接口检测逻辑

### 功能实现致谢

- **EPG解析优化**: 参考了iptv-api项目的数据处理思路，并结合awk脚本提高了处理效率
- **频道匹配算法**: 综合了多个项目的字符串匹配方法，实现了更智能的频道名称匹配
- **版本公告系统**: 借鉴了luci-app-store的更新机制，并进行了针对IPTV应用场景的定制
- **HTTPS支持**: 参考了多个OpenWRT项目的SSL实现，简化了证书生成和配置流程
- **界面优化**: 采纳了社区中多个设计建议，提升了用户体验

### 特别鸣谢

感谢所有在GitHub和恩山论坛上分享经验和代码的开发者，他们的宝贵贡献使本项目得以不断完善和发展。

## 未来计划

我们计划在下一个版本中添加以下功能：

- 支持云端频道源订阅
- 客户端播放历史同步
- 基于机器学习的频道推荐
- 更多客户端平台支持 