# IFLV (假驴子) 项目需求文档

<div align="center">
  <img src="assets/logo.png" alt="IFLV Logo" width="200"/>
  <h3>IPTV转发插件需求规格说明书</h3>
</div>

## 文档信息

| 文档信息 | 描述 |
|---------|------|
| 文档名称 | IFLV (假驴子) 项目需求文档 |
| 版本号   | 1.0.0 |
| 创建日期 | 2024-03-02 |
| 最后更新 | 2024-03-02 |
| 状态     | 正式发布 |

## 目录

1. [项目概述](#1-项目概述)
2. [需求背景](#2-需求背景)
3. [总体功能需求](#3-总体功能需求)
4. [版本需求计划](#4-版本需求计划)
   - [4.1 版本0.2.0需求](#41-版本020需求)
   - [4.2 版本1.0.0需求](#42-版本100需求)
   - [4.3 未来版本规划](#43-未来版本规划)
5. [各平台适配需求](#5-各平台适配需求)
6. [详细功能需求](#6-详细功能需求)
   - [6.1 服务端功能](#61-服务端功能)
   - [6.2 管理端功能](#62-管理端功能)
   - [6.3 用户端功能](#63-用户端功能)
   - [6.4 下载端功能](#64-下载端功能)
7. [非功能性需求](#7-非功能性需求)
8. [界面需求](#8-界面需求)
9. [用户场景](#9-用户场景)
10. [术语表](#10-术语表)

## 1. 项目概述

IFLV (假驴子) 是一款运行在OpenWRT路由器上的智能IPTV转发插件，通过监听IPTV网口数据包并进行智能解析，模拟IPTV机顶盒将组播信号转为单播，从而实现家庭内网所有设备通过访问同一地址观看直播和回放。

项目目标是解决传统IPTV服务仅限于机顶盒观看的限制，使家庭内任何设备(电脑、手机、平板等)都能方便地观看IPTV内容，无需额外付费多开会员。

## 2. 需求背景

随着智能设备的普及，用户希望能够在多种设备上灵活观看IPTV内容，而不仅限于传统电视机顶盒。然而，目前IPTV服务提供商通常采用组播技术传输信号，这种信号无法直接被普通设备接收。

此外，即使有些IPTV提供商推出了手机APP和网页版，也往往需要额外付费，且通常限制同时在线设备数量，不能满足家庭内多设备同时观看的需求。

IFLV项目应运而生，旨在通过在路由器层面实现信号转发，一次部署即可让全家设备共享观看，无需额外费用或复杂配置。

## 3. 总体功能需求

IFLV的核心功能需求包括：

1. **智能组播转单播**：监听IPTV数据包并转换为内网可访问的单播信号
2. **多模式支持**：支持双网线模式、VLAN模式和VLAN透传模式，适应不同的网络环境
3. **EPG节目单管理**：自动获取、匹配和管理电视节目信息和电子节目指南
4. **友好的中文界面**：完全中文化的OpenWRT插件界面，简单易用
5. **状态监控与诊断**：实时监控网络状态，智能诊断问题并提供解决方案
6. **多平台支持**：兼容OpenWRT、iStore、爱快、小米路由器、群晖NAS和Docker等多种平台
7. **专属客户端**：提供安卓、Windows、Mac和iOS平台专用客户端，一键配置使用
8. **在线更新**：支持节目源和EPG在线更新，保持内容的实时性和丰富度

## 4. 版本需求计划

### 4.1 版本0.2.0需求

该版本是IFLV的早期版本，主要功能需求如下：

1. **兼容iStore一键安装**
   - 与iStore平台集成，支持一键安装和配置
   - 实现平台自适应，自动识别并优化配置

2. **多平台支持与优化**
   - 针对6个平台（OpenWRT、iStore、爱快、小米路由器、群晖NAS、Docker）进行优化
   - 提供各平台独立分支版本，针对性解决平台特定问题

3. **客户端下载服务**
   - 内置下载服务器，提供Android、Windows、Mac、iOS客户端下载
   - 提供统一的下载入口，方便用户获取客户端软件

4. **四端服务架构**
   - 服务端：核心转发功能，可部署在路由器或其他设备上
   - 管理端：Web界面，用于配置和监控
   - 用户端：各种设备的客户端应用
   - 下载端：客户端分发服务

5. **专属客户端功能**
   - 支持免配置使用，自动发现家庭内的IFLV服务
   - 支持自动启动和服务端推送更新通知

### 4.2 版本1.0.0需求

作为第一个正式版本，该版本在0.2.0的基础上进行了大量改进和功能增强：

1. **在线节目源与EPG更新**
   - 支持从多个在线源自动获取最新的节目列表
   - 实现EPG电子节目单的在线更新和本地缓存
   - 支持节目源自动匹配和手动导入

2. **集成iStore一键安装功能**
   - 深度集成iStore生态系统
   - 优化安装流程，减少用户操作步骤
   - 支持iStore应用商店内一键更新

3. **全平台预编译IPK安装包**
   - 为所有支持的路由器架构提供预编译的IPK安装包
   - 包括arm_cortex-a7/a9/a15、mipsel_24kc、mips_24kc、x86_64、aarch64_cortex-a53等架构

4. **一键安装脚本**
   - 提供通用的一键安装脚本，自动检测设备架构和平台类型
   - 自动下载并安装对应版本的软件包和依赖
   - 提供安装过程可视化反馈和故障诊断

5. **客户端下载服务HTTPS支持**
   - 客户端下载服务升级支持HTTPS安全连接
   - 增加可选的访问认证功能
   - 支持自定义下载服务端口

6. **多平台兼容性优化**
   - 解决各平台特有问题，提升稳定性
   - 优化资源占用，降低对设备的性能要求
   - 支持更多的边缘设备和旧设备

### 4.3 未来版本规划

未来版本的主要需求方向：

1. **智能频道识别与分类**
   - 自动对频道进行分类（如新闻、体育、电影等）
   - 支持用户自定义频道分组和排序
   - 提供频道搜索和收藏功能

2. **录制与时移功能**
   - 支持节目录制到本地存储或网络存储
   - 提供直播时移功能，支持暂停、倒带、快进
   - 支持录制节目的管理和分享

3. **内容推荐系统**
   - 基于用户观看历史推荐相关内容
   - 推送热门节目和特别节目提醒
   - 支持用户自定义兴趣标签

4. **多用户支持**
   - 家庭成员独立的用户配置文件
   - 不同用户的观看历史和收藏独立管理
   - 家长控制功能，限制特定内容的访问

5. **跨网络访问**
   - 安全的远程访问机制
   - 支持在外网观看家中IPTV内容
   - 流量控制和画质自适应

## 5. 各平台适配需求

### OpenWRT版本
- 支持OpenWRT 18.06及以上版本
- 提供LuCI界面集成
- 兼容主流OpenWRT软路由设备
- 支持从官方软件源安装

### iStore版本
- 与iStore应用中心深度集成
- 支持一键安装和更新
- 适配iStore特定API和界面风格
- 优化性能，减少资源占用

### 爱快(AiQuick)版本
- 适配爱快系统的网络结构
- 提供与爱快管理界面风格一致的操作界面
- 优化数据包处理逻辑，提高转发效率
- 支持爱快系统的负载均衡和带宽控制

### 小米路由器版本
- 支持小米路由器ROM特有功能
- 针对小米路由器硬件进行优化
- 集成小米路由器用户界面风格
- 适配小米MIWIFI系列路由器

### 群晖(Synology)版本
- 提供DSM套件安装包
- 支持DSM 6.x和7.x系统
- 通过Docker方式部署服务
- 利用群晖存储功能实现节目录制

### Docker版本
- 提供标准Docker镜像
- 支持环境变量配置各项参数
- 优化容器体积和资源使用
- 提供docker-compose配置示例

## 6. 详细功能需求

### 6.1 服务端功能

1. **核心转发功能**
   - 监听IPTV组播数据包
   - 转换为HTTP/RTSP单播流
   - 支持多种视频编码格式(MPEG-TS, H.264, H.265等)
   - 智能缓冲和数据包重组

2. **网络适配**
   - 双网线模式：使用两个物理网口分别连接调制解调器和内网
   - VLAN模式：在同一物理网口上通过VLAN隔离IPTV流量
   - VLAN透传模式：在交换机环境中透传VLAN标签
   - 自动检测和配置网络参数

3. **协议支持**
   - IGMP协议处理
   - RTSP/RTP流处理
   - HTTP/HLS流处理
   - UDP多播转发

4. **系统集成**
   - 与路由器系统服务集成
   - 开机自启动
   - 状态监控和日志记录
   - 资源占用优化

### 6.2 管理端功能

1. **Web管理界面**
   - 提供基于LuCI的图形界面
   - 支持移动设备自适应显示
   - 完整的中文本地化支持
   - 直观的状态展示和配置选项

2. **频道管理**
   - 频道列表导入/导出
   - 频道编辑和排序
   - 频道分组和标签管理
   - 频道状态监控

3. **EPG管理**
   - EPG源设置和管理
   - EPG数据更新调度
   - EPG与频道匹配设置
   - EPG数据缓存管理

4. **系统设置**
   - 工作模式选择
   - 网络参数配置
   - 下载服务配置
   - 性能和缓存设置

5. **监控和诊断**
   - 实时状态监控
   - 问题自动检测和诊断
   - 网络连接测试
   - 日志记录和分析

### 6.3 用户端功能

1. **通用客户端需求**
   - 自动发现家庭内的IFLV服务
   - 频道列表显示和搜索
   - 播放控制（播放、暂停、音量等）
   - 收藏频道管理

2. **Android客户端**
   - 支持Android 5.0及以上系统
   - 背景播放和画中画支持
   - 与Android TV系统集成
   - 支持外部播放器调用

3. **Windows客户端**
   - 支持Windows 7及以上系统
   - 多窗口和多显示器支持
   - 系统托盘集成
   - 快捷键自定义

4. **Mac客户端**
   - 支持macOS 10.12及以上系统
   - 暗黑模式支持
   - Touch Bar集成
   - 屏幕保护功能

5. **iOS客户端**
   - 基于TestFlight分发或第三方播放器支持
   - 支持iOS 12及以上系统
   - 支持画中画功能
   - 与Apple TV集成

### 6.4 下载端功能

1. **客户端分发服务**
   - 内置Web服务器提供客户端下载
   - 客户端版本管理
   - 自动检测客户端更新
   - 支持HTTP和HTTPS访问

2. **更新通知**
   - 客户端新版本推送通知
   - 服务端更新提醒
   - 重要功能变更通知
   - 问题修复公告

3. **客户端配置分发**
   - 预配置客户端参数
   - 二维码快速配置
   - 配置同步和备份
   - 多设备配置管理

## 7. 非功能性需求

1. **性能需求**
   - 支持至少10个同时在线客户端
   - CPU占用不超过50%（基于标准OpenWRT路由器）
   - 内存占用不超过100MB
   - 频道切换延迟不超过3秒

2. **安全需求**
   - 仅限内网访问核心服务
   - 可选的访问控制和认证
   - 不存储敏感用户信息
   - 安全的数据传输机制

3. **稳定性需求**
   - 7x24小时稳定运行
   - 自动恢复机制
   - 定期自检和维护
   - 故障隔离和优雅降级

4. **兼容性需求**
   - 支持主流IPTV服务提供商
   - 兼容各种网络环境和设备
   - 向后兼容旧版本配置
   - 兼容多种视频编码和容器格式

## 8. 界面需求

1. **管理界面设计**
   - 简洁明了的布局
   - 响应式设计，适应不同屏幕尺寸
   - 符合中文用户使用习惯
   - 关键信息突出显示

2. **用户客户端界面**
   - 直观的频道列表和分类
   - 简单易用的播放控制
   - 清晰的EPG信息展示
   - 一致的跨平台用户体验

3. **下载页面设计**
   - 清晰的客户端下载分类
   - 版本信息和更新日志展示
   - 安装指南和帮助信息
   - 问题反馈入口

## 9. 用户场景

### 场景1：家庭多设备观看
张先生家中有一台电视机顶盒，但全家人都希望能在各自的设备上观看IPTV。通过在路由器上安装IFLV，他们可以在客厅电视、卧室平板、书房电脑以及手机上同时观看不同频道，而无需额外费用。

### 场景2：频道录制和回看
李女士经常因工作错过喜欢的电视节目。通过IFLV的录制功能，她可以预设录制时间，系统会自动将节目保存到NAS或USB存储设备上，她回家后可以随时观看。

### 场景3：外出时观看家中IPTV
王先生出差时想观看家乡的本地新闻。通过IFLV的远程访问功能，他可以安全地连接到家中的系统，在酒店使用笔记本电脑观看家乡的IPTV频道。

### 场景4：老人和孩子使用
周爷爷不会操作复杂的设备，但想在iPad上看戏曲频道。IFLV客户端简单直观的界面和自动发现功能，让他只需点击应用图标和频道名称即可开始观看，无需复杂配置。

## 10. 术语表

| 术语 | 解释 |
|------|-----|
| IPTV | 交互式网络电视，通过IP网络传送电视内容的技术 |
| EPG  | Electronic Program Guide，电子节目指南，显示频道节目信息 |
| 组播 | 一种网络技术，允许一个数据包同时发送给多个接收者 |
| 单播 | 点对点传输，一个发送者对应一个接收者 |
| VLAN | Virtual Local Area Network，虚拟局域网 |
| LuCI | OpenWRT的Web配置界面 |
| RTSP | Real Time Streaming Protocol，实时流协议 |
| HLS  | HTTP Live Streaming，基于HTTP的流媒体传输协议 | 